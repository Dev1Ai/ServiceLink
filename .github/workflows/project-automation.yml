name: Project Automation

permissions:
  contents: write
  issues: write
  pull-requests: write
  projects: write

on:
  workflow_dispatch:
  issues:
    types: [opened, labeled, reopened, closed]
  pull_request:
    types: [opened, labeled, reopened, synchronize, closed]

jobs:
  debug-token:
    runs-on: ubuntu-latest
    steps:
      - name: Debug GitHub token permissions
        run: |
          echo "üîç Checking token scopes..."
          curl -s -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" https://api.github.com/rate_limit
          echo "‚úÖ If this call succeeds, the token is valid."
          echo "üîç Checking repo permissions from GitHub context..."
          echo "${{ toJson(github.permissions) }}"

  auto-label:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/labeler@v5
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}

  add-to-project:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/add-to-project@v0.5.0
        with:
          project-url: https://github.com/orgs/${{ github.repository_owner }}/projects/1
          github-token: ${{ secrets.GITHUB_TOKEN }}
          labeled: m0,m1,m2,m3,m4,m5,m6,m7
